(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[863],{8462:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chapter8",function(){return r(1974)}])},42:function(e,s,r){"use strict";r.r(s);var n=r(5893),l=r(7294),o=r(2489),i=r(9417);s.default=e=>{let{name:s,answers:r=[],correctAnswer:t}=e,[c,a]=(0,l.useState)(""),[h,d]=(0,l.useState)(""),x=e=>{a(e.target.value)};return(0,n.jsxs)("div",{className:"max-w-md mx-auto p-5 m-12 border rounded-md shadow-md",children:[(0,n.jsxs)("h2",{className:"py-2 text-2xl font-bold mb-4 flex items-center justify-center",children:[(0,n.jsx)("span",{role:"img","aria-label":"question mark",className:"mr-2",children:(0,n.jsx)(o.G,{icon:i.Fuz,className:"text-blue-500 h-7 w-7"})}),(0,n.jsx)("span",{children:"是时候做个测验了！"})]}),(0,n.jsx)("legend",{class:"text-sm font-semibold leading-6 text-gray-900",children:s}),(0,n.jsx)("div",{class:"mt-6 space-y-4",children:r.map((e,s)=>(0,n.jsxs)("div",{class:"flex items-center gap-x-3",children:[(0,n.jsx)("input",{value:e,checked:c===e,onChange:x,id:s,name:"push-notifications",type:"radio",class:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,n.jsx)("label",{for:s,class:"block text-sm font-medium leading-6 text-gray-900",children:e})]},s))}),(0,n.jsx)("div",{className:"mt-4 text-right",children:(0,n.jsx)("button",{onClick:()=>{c===t?d("回答正确！\uD83C\uDF89"):d("回答错误，请再试一次。")},className:"px-3 py-1.5 bg-blue-500 text-white rounded-md",children:"检查答案"})}),h&&(0,n.jsx)("div",{className:"mt-4 text-lg font-semibold ".concat(h.includes("正确")?"text-green-500":"text-red-500"),children:h})]})}},979:function(e,s,r){"use strict";var n=r(5893),l=r(1163);let o=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("link",{rel:"icon",type:"image/x-icon",href:"/favicon.ico"}),(0,n.jsx)("meta",{name:"description",content:"Learn Next.js 中文教程"})]}),i={head:o,logo:(0,n.jsx)("span",{children:"Learn Next.js 中文教程"}),project:{link:"https://github.com/qufei1993/nextjs-learn-cn"},docsRepositoryBase:"https://github.com/qufei1993/nextjs-learn-cn",search:{placeholder:"Search"},sidebar:{toggleButton:!0,titleComponent(e){let{title:s,type:r}=e;return["Chapter 10","Chapter 11","Chapter 12","Chapter 13","Chapter 14","Chapter 15","Chapter 16"].includes(s.split("：")[0])?(0,n.jsx)("div",{style:{color:"#d8d8d8",pointerEvents:"none"},children:s}):s}},toc:{backToTop:!0,extraContent:(0,n.jsx)(()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{class:"flex flex-col items-center",children:[(0,n.jsx)("img",{src:"/coding-may.jpeg",alt:"Description",class:"mb-4 rounded-md shadow-lg"}),(0,n.jsxs)("p",{class:"nx-text-xs font-bold text-center",children:["扫码备注 “nextjs”",(0,n.jsx)("br",{}),"加入 Next.js 中文技术交流群"]})]})}),{})},feedback:{content:null},useNextSeoProps(){let{asPath:e}=(0,l.useRouter)();return"/"===e?{titleTemplate:"Learn Next.js 中文教程"}:{titleTemplate:"%s - Learn Next.js 中文教程"}},gitTimestamp:null,footer:{text:(0,n.jsx)("span",{children:(0,n.jsx)("a",{href:"https://github.com/qufei1993/nextjs-learn-cn/blob/main/LICENSE",target:"_blank",children:"MIT License - Copyright (c) 2023"})})}};s.Z=i},1974:function(e,s,r){"use strict";r.r(s),r.d(s,{__toc:function(){return h},default:function(){return p}});var n=r(5893),l=r(2673),o=r(9298),i=r(979);r(9966);var t=r(2643),c={src:"/_next/static/media/chapter8-static-site-generation.4e6914d8.avif",height:888,width:3200,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgIPaIEBA0IMgwXwAAASXAAAR6f//M=",blurWidth:8,blurHeight:2},a=r(42);let h=[{depth:2,value:"什么是静态渲染？",id:"什么是静态渲染"},{depth:2,value:"什么是动态渲染？",id:"什么是动态渲染"},{depth:2,value:"使 Dashboard 动态化",id:"使-dashboard-动态化"},{depth:2,value:"模拟慢速数据获取",id:"模拟慢速数据获取"}];function d(e){let s=Object.assign({h1:"h1",p:"p",ul:"ul",li:"li",h2:"h2",a:"a",img:"img",strong:"strong",code:"code",pre:"pre",span:"span",blockquote:"blockquote"},(0,t.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"静态和动态渲染"}),"\n",(0,n.jsx)(s.p,{children:"在上一章中，您为 Dashboard 概述页面获取了数据。但是，我们简要讨论了当前设置的两个局限性："}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"数据请求正在创造一个无意的瀑布。"}),"\n",(0,n.jsx)(s.li,{children:"Dashboard 是静态的，因此任何数据更新都不会反映在您的应用程序上。"}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"以下是本章中将涵盖的主题："}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"什么是静态渲染，以及它如何提高应用程序的性能。"}),"\n",(0,n.jsx)(s.li,{children:"什么是动态渲染以及何时使用它。"}),"\n",(0,n.jsx)(s.li,{children:"使 Dashboard 动态化的不同方法。"}),"\n",(0,n.jsx)(s.li,{children:"模拟一个缓慢的数据获取，看看会发生什么。"}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"什么是静态渲染",children:"什么是静态渲染？"}),"\n",(0,n.jsxs)(s.p,{children:["使用静态渲染，数据获取和渲染在构建时（部署时）或",(0,n.jsx)(s.a,{href:"https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#revalidating-data",children:"重新验证期间"}),"在服务器上进行。然后，结果可以在",(0,n.jsx)(s.a,{href:"https://nextjs.org/docs/app/building-your-application/rendering/server-components#static-rendering-default",children:"内容分发网络（CDN）"}),"中分发和缓存。"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"显示用户在请求页面时如何访问 CDN 而不是服务器的图",placeholder:"blur",src:c})}),"\n",(0,n.jsx)(s.p,{children:"每当用户访问你的应用程序时，缓存的结果都会被提供。静态渲染有几个好处："}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"更快的网站"})," - 预渲染的内容可以被缓存和全球分布。这确保了世界各地的用户可以更快、更可靠地访问您的网站内容。"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"减少服务器负载"})," - 由于内容被缓存，您的服务器不必为每个用户请求动态生成内容。"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"搜索引擎优化"})," - 预渲染内容更容易被搜索引擎爬虫索引，因为当页面加载时，内容已经可用。这可以提高搜索引擎排名。"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["静态渲染对于",(0,n.jsx)(s.strong,{children:"没有数据"}),"或",(0,n.jsx)(s.strong,{children:"跨用户共享数据"}),"的 UI（如静态博客文章或产品页面）非常有用。它可能不适合具有定期更新的个性化数据的 Dashboard。"]}),"\n",(0,n.jsx)(s.p,{children:"与静态渲染相反的是动态渲染。"}),"\n",(0,n.jsx)(a.default,{name:"为什么静态渲染不适合 Dashboard 应用程序？",answers:["因为它会使网站变慢","因为服务器负载会增加","因为应用程序不会反映最新的数据更改","因为你需要一个内容分发网络（CDN）"],correctAnswer:"因为应用程序不会反映最新的数据更改"}),"\n",(0,n.jsx)(s.h2,{id:"什么是动态渲染",children:"什么是动态渲染？"}),"\n",(0,n.jsx)(s.p,{children:"通过动态渲染，内容在请求时（当用户访问页面时）在服务器上为每个用户呈现。动态渲染有几个好处："}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"实时数据"})," - 动态渲染允许您的应用程序显示实时或频繁更新的数据。这对于数据经常变化的应用程序来说是理想的。"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"用户特定内容"})," - 提供个性化内容（如 Dashboard 或用户配置文件）并根据用户交互更新数据更容易。"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"请求时间信息"})," - 动态渲染允许您访问只能在请求时知道的信息，如 Cookie 或 URL 搜索参数。"]}),"\n"]}),"\n",(0,n.jsx)(a.default,{name:"哪些信息只能在请求时知道？",answers:["数据库模式","URL 路径","Cookie 和 URL 搜索参数"],correctAnswer:"Cookie 和 URL 搜索参数"}),"\n",(0,n.jsx)(s.h2,{id:"使-dashboard-动态化",children:"使 Dashboard 动态化"}),"\n",(0,n.jsxs)(s.p,{children:["默认情况下，",(0,n.jsx)(s.code,{children:"@vercel/postgresql"})," 不设置自己的缓存语义。这允许框架设置自己的静态和动态行为。"]}),"\n",(0,n.jsxs)(s.p,{children:["您可以在服务器组件或数据获取函数中使用名为 ",(0,n.jsx)(s.code,{children:"unstable_noStore"})," 的 Next.js API 来选择退出静态呈现。让我们添加这个。"]}),"\n",(0,n.jsxs)(s.p,{children:["在你的 ",(0,n.jsx)(s.code,{children:"data.ts"})," 中，从 ",(0,n.jsx)(s.code,{children:"next/cache"})," 导入 ",(0,n.jsx)(s.code,{children:"unstable_noStore"}),"，并在数据获取函数的顶部调用它："]}),"\n",(0,n.jsx)(s.pre,{"data-language":"js","data-theme":"default",filename:"/app/lib/data.ts",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-line-numbers":"","data-language":"js","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { unstable_noStore "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" noStore } "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'next/cache'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchRevenue"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Add noStore() here to prevent the response from being cached."})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// This is equivalent to in fetch(..., {cache: 'no-store'})."})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchLatestInvoices"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchCardData"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchFilteredInvoices"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  query"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  currentPage"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"number"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchInvoicesPages"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(query"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchFilteredCustomers"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(query"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchInvoiceById"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(query"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"noStore"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"注意"}),"：",(0,n.jsx)(s.code,{children:"unstable_noStore"})," 是一个实验性的 API，可能在将来发生变化。如果您更喜欢在自己的项目中使用稳定的 API，您也可以使用 ",(0,n.jsx)(s.a,{href:"https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config",children:"Segment 配置选项"})," ",(0,n.jsx)(s.code,{children:'export const dynamic = "force-dynamic"'}),"。"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"模拟慢速数据获取",children:"模拟慢速数据获取"}),"\n",(0,n.jsx)(s.p,{children:"使 Dashboard 动态化是迈出的良好第一步。然而... 还有一个我们在上一章提到的问题。如果一个数据请求比其他所有请求都慢，会发生什么？"}),"\n",(0,n.jsxs)(s.p,{children:["让我们模拟一次慢速数据获取。在您的 ",(0,n.jsx)(s.code,{children:"data.ts"})," 文件中，取消注释 ",(0,n.jsx)(s.code,{children:"fetchRevenue()"})," 函数内部的 ",(0,n.jsx)(s.code,{children:"console.log"})," 和 ",(0,n.jsx)(s.code,{children:"setTimeout"}),"："]}),"\n",(0,n.jsx)(s.pre,{"data-language":"ts","data-theme":"default",filename:"/app/lib/data.ts",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-line-numbers":"","data-language":"ts","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchRevenue"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"try"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 为演示目的，我们人为延迟响应。"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 在生产中请勿这样做 :)"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'Fetching revenue data...'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"Promise"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"((resolve) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setTimeout"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(resolve"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3000"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"));"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"sql"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Revenue"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"`SELECT * FROM revenue`"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line highlighted",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'Data fetch completed after 3 seconds.'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".rows;"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  } "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"catch"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (error) {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".error"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'Database Error:'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" error);"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"throw"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Error"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'Failed to fetch revenue data.'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsxs)(s.p,{children:["现在在新标签页中打开 ",(0,n.jsx)(s.a,{href:"http://localhost:3000/dashboard/%EF%BC%8C",children:"http://localhost:3000/dashboard/，"})," 注意页面加载所需的时间较长。在终端中，您还应该看到以下消息："]}),"\n",(0,n.jsx)(s.pre,{"data-language":"text","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Fetching revenue data..."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Data fetch completed after 3 seconds."})})]})}),"\n",(0,n.jsx)(s.p,{children:"在这里，您添加了一个人为的 3 秒延迟，以模拟慢速数据获取。结果是在获取数据时整个页面被阻塞。"}),"\n",(0,n.jsx)(s.p,{children:"这引出了开发者必须解决的一个常见挑战："}),"\n",(0,n.jsxs)(s.p,{children:["使用动态渲染，",(0,n.jsx)(s.strong,{children:"您的应用程序速度只有在最慢的数据获取完成时才能达到"}),"。"]})]})}let x={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,t.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)},pageOpts:{filePath:"src/pages/chapter8.mdx",route:"/chapter8",pageMap:[{kind:"Meta",data:{index:{title:"Home",theme:{breadcrumb:!1},display:"hidden"},chapter1:"Chapter 1：入门",chapter2:"Chapter 2：CSS 样式",chapter3:"Chapter 3：优化字体和图片",chapter4:"Chapter 4：创建 Layouts 和 Pages",chapter5:"Chapter 5：页面之间导航",chapter6:"Chapter 6：建立你的数据库",chapter7:"Chapter 7：获取数据",chapter8:"Chapter 8：静态和动态渲染",chapter9:"Chapter 9：流式传输",chapter10:"Chapter 10：部分预渲染（翻译中）",chapter11:"Chapter 11：添加搜索和分页（翻译中）",chapter12:"Chapter 12：Mutating 数据（翻译中）",chapter13:"Chapter 13：错误处理（翻译中）",chapter14:"Chapter 14：提高可访问性（翻译中）",chapter15:"Chapter 15：添加身份验证（翻译中）",chapter16:"Chapter 16：添加元数据（翻译中）",chapter17:"扩展篇 1：Vercel Postgres 搭配本地数据库"}},{kind:"MdxPage",name:"chapter1",route:"/chapter1"},{kind:"MdxPage",name:"chapter10",route:"/chapter10"},{kind:"MdxPage",name:"chapter11",route:"/chapter11"},{kind:"MdxPage",name:"chapter12",route:"/chapter12"},{kind:"MdxPage",name:"chapter13",route:"/chapter13"},{kind:"MdxPage",name:"chapter14",route:"/chapter14"},{kind:"MdxPage",name:"chapter15",route:"/chapter15"},{kind:"MdxPage",name:"chapter16",route:"/chapter16"},{kind:"MdxPage",name:"chapter17",route:"/chapter17"},{kind:"MdxPage",name:"chapter2",route:"/chapter2"},{kind:"MdxPage",name:"chapter3",route:"/chapter3"},{kind:"MdxPage",name:"chapter4",route:"/chapter4"},{kind:"MdxPage",name:"chapter5",route:"/chapter5"},{kind:"MdxPage",name:"chapter6",route:"/chapter6"},{kind:"MdxPage",name:"chapter7",route:"/chapter7"},{kind:"MdxPage",name:"chapter8",route:"/chapter8"},{kind:"MdxPage",name:"chapter9",route:"/chapter9"},{kind:"MdxPage",name:"index",route:"/"}],flexsearch:{codeblocks:!0},title:"静态和动态渲染",headings:h},pageNextRoute:"/chapter8",nextraLayout:o.ZP,themeConfig:i.Z};var p=(0,l.j)(x)}},function(e){e.O(0,[976,53,603,774,888,179],function(){return e(e.s=8462)}),_N_E=e.O()}]);